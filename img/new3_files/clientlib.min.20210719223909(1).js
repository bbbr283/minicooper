define("apps/minidigital/components/featuregroup/clientlib","jquery bowser core/TrackingAdapter core/Slider core/Messagebus core/utils/viewportspy core/utils/scrollspy core/utils/url apps/minidigital/components/introslider/clientlib".split(" "),function(d,p,e,l,g,h,q,m,r){var n=function(a){this.$element=d(a);this._id=this.$element[0].id;this.isTrackingActive=(this.trackingObj=e.getInstance())&&!this.trackingObj.isTrackingDisabled();this.ScrollSpy=q.init();this.$featuregroupHead=this.$element.find('[data-fg-role\x3d"featuregroup-head"]');
this.$featuregroupHeadSlides=this.$featuregroupHead.find('[data-fg-role\x3d"slide"]');this.$gallery=this.$element.find('[data-fg-role\x3d"featuregroup-main"]');this.$galleryFeatures=this.$gallery.find('[data-fg-role\x3d"featuregroup-feature"]');this.$modal=this.$element.find('[data-fg-role\x3d"featuregroup-modal"]');this.$modalFeatures=this.$modal.find('[data-fg-role\x3d"featuregroup-feature"]');this.modalSliderId=Math.random().toString(36).substr(2,9);this.modalSliderHash="#fgoverlay"+this.modalSliderId;
this.$modalSliderWrapper=d("\x3cdiv/\x3e",{"class":"md-feature-group-overlay-wrapper md-next",id:"fg-overlay-wrapper-"+this.modalSliderId});this.$modalClose=d("\x3cbutton/\x3e",{"class":"md-feature-group-overlay-close",html:'\x3cspan class\x3d"eca-aural"\x3eclose\x3c/span\x3e'});this.isModalVisible=!1;this.$slider=d('\x3csection class\x3d"md-feature-group-list-slider" /\x3e');this.settings={theme:"white",maxItemsBeforeSlider:4,maxSliderItems:5,minHeightForDescription:165};this.viewport=h.viewportData.minwidth.tabletPortrait?
"wide":"narrow";this.clickEvent=Modernizr.touch?"tap":"click";this.swiped=!1;this.init()};n.prototype={init:function(){this.initHighlightSlider();this.initSlider();this.initModal();this.updateCopyContainer();this.initEvents();this.isTrackingActive&&this.initTracking()},initEvents:function(){this.$galleryFeatures.find('[data-fg-role\x3d"copy"][data-fg-state]').on("click",this.onFeatureCopyClick.bind(this));this.$modalFeatures.find('[data-fg-role\x3d"copy"][data-fg-state]').on("click",this.onFeatureCopyClick.bind(this));
this.$galleryFeatures.find('[data-fg-role\x3d"asset"]').on("click",this.onAssetClick.bind(this));g.subscribe({channel:"md:video",topic:"state:change",callback:this.onVideoStateChange.bind(this,this.$modalSliderWrapper[0])});g.subscribe({channel:h.messages.channel,topic:h.messages.events.RESIZE,callback:this.onResize.bind(this)});this.$modalClose.on("click",this.onModalClose.bind(this));d(document).keyup(this.onKeyUp.bind(this));window.addEventListener("popstate",this.onHashChange.bind(this),!1);p.ie&&
window.addEventListener("hashchange",this.onHashChange.bind(this),!1)},initHighlightSlider:function(){if(0<this.$featuregroupHeadSlides.length){this.$featuregroupHead.attr("data-fg-slider","active");var a={doNotTrack:!0,slickSettings:{appendDots:this.$featuregroupHead}};this.$featuregroupHead.on("swipe",this.onSliderSwipe.bind(this));this.$featuregroupHead.on("afterChange",this.onHighlightSliderAfterChange.bind(this));this.HighlightSlider=new r(this.$featuregroupHead,a)}},initSlider:function(){this.$galleryFeatures.each(function(){d(this).data("featureIndex",
d(this).index())});if(this.$galleryFeatures.length>this.settings.maxItemsBeforeSlider&&(this.$sliderFeatures=this.$galleryFeatures.filter(":gt("+(this.settings.maxItemsBeforeSlider-2)+")"),0<this.$sliderFeatures.length)){this.$sliderPagination=d("\x3cdiv /\x3e",{"class":"slick-pagination",html:"1 / "+this.$sliderFeatures.length});this.hasDotNavigation=this.$sliderFeatures.length<=this.settings.maxSliderItems;var a={dots:this.hasDotNavigation,slidesToShow:1,slidesToScroll:1,arrows:!0,draggable:!1,
responsive:[{breakpoint:h.breakpoints.tabletPortrait,settings:{arrows:!0,draggable:!0}}]};this.$slider.append(this.$sliderFeatures).appendTo(this.$gallery);Modernizr.touch&&(this.$slider.on("touchstart",function(a){a.stopPropagation()}),this.$slider.on("touchmove",function(a){a.stopPropagation()}),this.$slider.on("touchend",function(a){a.stopPropagation()}),this.$slider.on("swipe",function(){}));this.$slider.on("beforeChange",this.onFeatureSliderBeforeChange.bind(this));this.$slider.on("afterChange",
this.onFeatureSliderAfterChange.bind(this));this.Slider=new l(this.$slider,a);this.hasDotNavigation||this.$slider.append(this.$sliderPagination)}},initModal:function(){this.$modalSliderWrapper=d("\x3cdiv/\x3e",{"class":"md-feature-group-overlay-wrapper md-next",id:"fg-overlay-wrapper-"+this.modalSliderId}).hide().append(this.$modal).append(this.$modalClose).appendTo("body");this.$element.hasClass("light-on-dark")&&this.$modalSliderWrapper.addClass("light-on-dark");this.initModalSlider()},initModalSlider:function(){this.$modal.on("beforeChange",
this.onModalSliderBeforeChange.bind(this));this.$modal.on("afterChange",this.onModalSliderAfterChange.bind(this));this.$modal.on("swipe",this.onSliderSwipe.bind(this));this.ModalSlider=new l(this.$modal,{slidesToShow:1,slidesToScroll:1,speed:300,arrows:!0,dots:!1,draggable:!1})},onModalClose:function(){this.hideModal()},onHashChange:function(){window.location.hash!=this.modalSliderHash&&this.hideModal()},onResize:function(a){this.updateCopyContainer();this.isModalVisible&&this.updateModalContent()},
onKeyUp:function(a){27==a.keyCode&&window.location.hash==this.modalSliderHash&&(a.preventDefault(),this.hideModal())},onHighlightSliderAfterChange:function(a,b,c){this.isTrackingActive&&(a=this.swiped?"swipe":this.clickEvent,g.publish({channel:e.getMessages().channel,topic:e.getMessages().events.TRIGGER_EVENT,data:{element:b.$slides[c],callbackFn:this.getHighlightImpressionData.bind(this,c,a)}}));this.swiped=!1},onFeatureSliderBeforeChange:function(a,b,c,k){a.stopPropagation();d(b.$slides[c]).find('[data-fg-state\x3d"maximized"]').trigger("click");
this.hasDotNavigation||b.$slider.find(".slick-pagination").html(k+1+" / "+this.$sliderFeatures.length)},onFeatureSliderAfterChange:function(a,b,c){a.stopPropagation();if(this.isTrackingActive){a=b.$slides[c];b=this.swiped?"swipe":this.clickEvent;var k=d(a).find(".h4").first().text().trim();g.publish({channel:e.getMessages().channel,topic:e.getMessages().events.TRIGGER_EVENT,data:{element:a,callbackFn:this.getTileImpressionData.bind(this,this.settings.maxItemsBeforeSlider-1+c,k,b)}})}this.swiped=!1},
onModalSliderBeforeChange:function(a,b,c,k){a.stopPropagation();d(b.$slides[c]).find('[data-fg-state\x3d"maximized"]').trigger("click")},onModalSliderAfterChange:function(a,b,c){a.stopPropagation();if(this.isTrackingActive){a=this.$galleryFeatures.eq(c)[0];b=this.swiped?"swipe":this.clickEvent;var k=d(a).find(".h4").first().text().trim();g.publish({channel:e.getMessages().channel,topic:e.getMessages().events.TRIGGER_EVENT,data:{element:a,callbackFn:this.getTileImpressionData.bind(this,c,k,b)}})}this.swiped=
!1},onSliderSwipe:function(a,b,c){this.swiped=!0},onVideoStateChange:function(a,b){if(b.player){var c=b.player.a||b.player.container;d.contains(a,c)&&(c=d(c).closest('[data-fg-role\x3d"featuregroup-feature"]'),0>=c.length&&(c=d(a)),a=c.find('[data-fg-role\x3d"copy"]'),1===b.state&&this.hideCopy(a),0!==b.state&&2!==b.state||this.showCopy(a))}},onAssetClick:function(a){h.viewportData.minwidth.tabletPortrait&&(a=d(a.target).closest('[data-fg-role\x3d"featuregroup-feature"]').data("featureIndex"),this.updateModalContent(),
this.showModal(a))},onFeatureCopyClick:function(a){a=d(a.currentTarget);if("disabled"==a.attr("data-fg-state"))return!1;"minimized"==a.attr("data-fg-state")?(this.maximizeCopy(a),a=d(this.ModalSlider.slick.$slides[this.ModalSlider.slick.currentSlide]),g.publish({channel:"md:video",topic:"do:pause",data:{container:a}})):this.minimizeCopy(a)},hideCopy:function(a){0>=a.length||a.css("bottom","-"+a.height()+"px")},showCopy:function(a){a.css("bottom","0")},minimizeCopy:function(a){a=a||d("");a.animate({height:a.data("minimizedCopyHeight")},
function(){a.find(".md-icn-angle-down").toggleClass("md-icn-angle-up md-icn-angle-down");a.find(".md-icnpost-angle-down").toggleClass("md-icnpost-angle-up md-icnpost-angle-down")});a.attr("data-fg-state","minimized")},maximizeCopy:function(a){a=a||d("");var b=a.children();a.animate({height:b.outerHeight()},function(){a.attr("data-fg-state","maximized");a.find(".md-icn-angle-up").toggleClass("md-icn-angle-up md-icn-angle-down");a.find(".md-icnpost-angle-up").toggleClass("md-icnpost-angle-up md-icnpost-angle-down")})},
showModal:function(a){d("html").css("overflow","hidden");a=a||0;m.updateHash(this.modalSliderHash,!1);this.$modal.show();this.$modalSliderWrapper.show();this.isModalVisible=!0;this.ModalSlider.slick.goTo(a,!0);g.publish({channel:"md:animatedimage",topic:"do:play",data:{container:this.$modalSliderWrapper}});this.startAnimation()},hideModal:function(){0<this.$modalSliderWrapper.length&&this.$modalSliderWrapper.is(":visible")&&(g.publish({channel:"md:video",topic:"do:pause",data:{container:this.$modalSliderWrapper}}),
g.publish({channel:"md:animatedimage",topic:"do:stop",data:{container:this.$modalSliderWrapper}}),this.$modalSliderWrapper.hide(),d("html").css("overflow","auto"),this.resetAnimation(),m.updateHash("",!1));this.isModalVisible=!1},startAnimation:function(){this.$modalSliderWrapper.find(".slick-arrow, .md-feature-group-copy, .md-feature-group-overlay-close").addClass("animation")},resetAnimation:function(){this.$modalSliderWrapper.find(".slick-arrow, .md-feature-group-copy, .md-feature-group-overlay-close").removeClass("animation")},
updateModalContent:function(){console.log("updateModalContentView");var a=d(window).height(),b=this.$modalFeatures.find('[data-fg-role\x3d"copy"]'),c=a-80;b.css({"max-height":c});b.each(function(){var b=d(this),e=b.parents('[data-fg-role\x3d"featuregroup-feature"]'),f=b.find(".h4");f=parseInt(b.children().css("padding-top"),10)+parseInt(b.children().css("padding-bottom"),10)+f.outerHeight(!0);0<e.find(".md-video-player").length||0<e.find(".md-youtubeplayer").length||0<e.find(".slick-cover").length?
f>a/2-50?(b.addClass("md-feature-group-copy-truncate").find("p").css("max-height",c-f),f=a/2-50):b.removeClass("md-feature-group-copy-truncate").find("p").css("max-height",c-f):b.find("p").css("max-height",c-f);b.data("minimizedCopyHeight",f).height(f)})},updateCopyContainer:function(){var a=this,b=0,c=h.viewportData.minwidth.tabletPortrait?"wide":"narrow";d.each(this.$galleryFeatures,function(){var e=d(this).find('[data-fg-role\x3d"copy"]'),g=e.children();b="narrow"==c?a.settings.minHeightForDescription+
e.find(".h4").outerHeight():parseInt(d(this).find('[data-fg-role\x3d"asset"]').outerHeight(),10);e.data("minimizedCopyHeight",b).height(b);var f=parseInt(g.css("padding-bottom"),10);f=b-f;g.height()>=f?e.attr("data-fg-state","minimized"):e.attr("data-fg-state","disabled")})},initTracking:function(){this.staticDataObj={id:this._id,defaultObj:{eventInfo:{},attributes:{relatedComponentID:this._id,relatedComponentName:"feature gallery",relatedComponentPrimaryCategory:"gallery",relatedContentHeadline:this.$element.find(".copy-wrapper .h1").text().trim()},
category:{primaryCategory:"gallery",subCategory01:"feature gallery"}},defaultEventObj:{eventInfo:{eventName:"tile view",eventAction:"na",eventPoints:1,cause:"automatic",effect:"tile view"},attributes:{tileName:1}}};e.register(this.$featuregroupHead[0],this.staticDataObj,this.getHighlightImpressionData.bind(this));this.$galleryFeatures.each(this.registerGalleryFeatures.bind(this))},getHighlightImpressionData:function(a,b){void 0!==a&&a++;return{eventInfo:{eventAction:b||"na",eventPoints:a,cause:b?
"default":"automatic"}}},registerGalleryFeatures:function(a,b){var c=d(b).find(".h4").first().text().trim();e.register(b,this.staticDataObj,this.getTileImpressionData.bind(this,a,c))},getTileImpressionData:function(a,b,c){return{eventInfo:{eventAction:c||"na",eventPoints:a+1,cause:"undefined"!==typeof c?"default":"automatic",effect:this.isModalVisible?"big picture is shown":"small picture is shown"},attributes:{tileName:b}}}};return n});